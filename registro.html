<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - CLIPSAFE</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/estilos.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 70px; /* Espacio para la barra de navegación fija */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .form-container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            margin-bottom: 30px;
            flex-grow: 1; /* Permite que el contenedor crezca para empujar el footer hacia abajo */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .form-container h2 {
            margin-bottom: 30px;
            color: #333;
            font-weight: bold;
            text-align: center;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            padding: 10px 20px;
            font-size: 1.1rem;
            border-radius: 8px;
            width: 100%;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }
        .alert-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        footer {
            margin-top: auto; /* Empuja el footer al final de la página */
        }
        #userStatus {
            color: white;
            margin-left: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a href="index.html" class="navbar-brand">CLIPSAFE</a>
            <button class="navbar-toggler" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarCLIPSAFE"
                    aria-controls="navbarCLIPSAFE"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCLIPSAFE">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a href="index.html#inicio" class="nav-link">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#nosotros" class="nav-link">Sobre Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#servicios" class="nav-link">Servicios</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#barberos" class="nav-link">Nuestros Barberos</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#contacto" class="nav-link">Contacto</a>
                    </li>
                    <li class="nav-item" id="authLinks">
                        <a href="login.html" class="nav-link">Iniciar Sesión</a>
                    </li>
                    <li class="nav-item">
                        <a href="registro.html" class="nav-link active">Registrarse</a>
                    </li>
                    <li class="nav-item">
                        <a href="agendar_cita.html" class="nav-link">Agendar Cita</a>
                    </li>
                    <li class="nav-item">
                        <a href="mis_citas.html" class="nav-link">Mis Citas</a>
                    </li>
                    <li class="nav-item">
                        <span id="userStatus" class="nav-link"></span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container d-flex flex-grow-1 align-items-center justify-content-center">
        <div class="row justify-content-center w-100">
            <div class="col-lg-6 col-md-8">
                <div class="form-container">
                    <h2>Registro de Usuario</h2>
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Correo Electrónico:</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Contraseña:</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirmar Contraseña:</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Registrarse</button>
                        <div id="message" class="alert-message" style="display: none;"></div>
                        <p class="text-center mt-3">¿Ya tienes una cuenta? <a href="login.html">Inicia sesión aquí</a></p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p class="text-white mb-0">&copy; 2025 CLIPSAFE. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script type="module" src="js/firebase_init.js"></script>

    <script type="module">
        import { auth } from './js/firebase_init.js';
        import { createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; 

        const registerForm = document.getElementById('registerForm');
        const registerEmailInput = document.getElementById('registerEmail');
        const registerPasswordInput = document.getElementById('registerPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const messageDiv = document.getElementById('message');
        const authLinksContainer = document.getElementById('authLinks');
        const userStatusSpan = document.getElementById('userStatus');

        function showMessage(msg, type) {
            messageDiv.textContent = msg;
            messageDiv.className = `alert-message alert-${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = registerEmailInput.value;
            const password = registerPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (password !== confirmPassword) {
                showMessage("Las contraseñas no coinciden.", "danger");
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showMessage("¡Registro exitoso! Redirigiendo para iniciar sesión...", "success");
                registerForm.reset();
                // Redirigir a la página de mis citas o al inicio después del registro
                window.location.href = 'mis_citas.html'; 
            } catch (error) {
                console.error("Error al registrar:", error);
                let errorMessage = "Error al registrar. Inténtalo de nuevo.";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "El correo electrónico ya está en uso.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "La contraseña es demasiado débil (mínimo 6 caracteres).";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Formato de correo electrónico inválido.";
                }
                showMessage(errorMessage, "danger");
            }
        });

        // Escucha cambios en el estado de autenticación para actualizar la barra de navegación
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userStatusSpan.textContent = `Bienvenido, ${user.email || 'Usuario Anónimo'}`;
                authLinksContainer.innerHTML = `
                    <a href="#" class="nav-link" id="logoutBtn">Cerrar Sesión</a>
                `;
                document.getElementById('logoutBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    try {
                        await auth.signOut();
                    } catch (error) {
                        console.error("Error al cerrar sesión:", error);
                    }
                });
            } else {
                userStatusSpan.textContent = '';
                authLinksContainer.innerHTML = `
                    <a href="login.html" class="nav-link">Iniciar Sesión</a>
                `;
            }
        });
    </script>
</body>
</html>
